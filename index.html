<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Lab3</title>
</head>
<body>
    <script>
        canvas = document.createElement("canvas");
        canvas.width = 600;
        canvas.height = 600;
        canvas.style.border = "1px solid";
        context = canvas.getContext("2d");
        context.filter = 'brightness(0.4)';
        document.body.appendChild(canvas);

        min_x = 200;
        max_x = 400;
        var x = Math.round(Math.random() * (max_x - min_x) + min_x);

        min_y = 150;
        max_y = 450;
        var y = Math.round(Math.random() * (max_y - min_y) + min_y);

        xhr = new XMLHttpRequest();
        xhr.open('GET', 'https://source.unsplash.com/random/?nature,winter,summer,autumn,spring', true);
        xhr.send(null);
        xhr.onload = function () {
            if (xhr.status !== 200){
                alert(`Error ${xhr.status}: ${xhr.statusText}`);
            } else {
                context = canvas.getContext("2d");
                img = new Image();
                img.onload = function () {
                    context.drawImage(img, 0, 0, x, y);
                };
                img.src = xhr.responseURL;
            }
        };

        setTimeout(function () {
            xhr.open('GET', 'https://source.unsplash.com/random/?humans', true);
            xhr.send(null);
            xhr.onload = function () {
                if (xhr.status !== 200){
                    alert(`Error ${xhr.status}: ${xhr.statusText}`);
                } else {
                    context = canvas.getContext("2d");
                    img = new Image();
                    img.onload = function () {
                        context.drawImage(img, x, 0, canvas.width - x, y);
                    };
                    img.src = xhr.responseURL;
                }
            }
        }, 2000);

        setTimeout(function () {
            xhr.open('GET', 'https://source.unsplash.com/random/?home,work,office', true);
            xhr.send(null);
            xhr.onload = function () {
                if (xhr.status !== 200){
                    alert(`Error ${xhr.status}: ${xhr.statusText}`);
                } else {
                    context = canvas.getContext("2d");
                    img = new Image();
                    img.onload = function () {
                        context.drawImage(img, 0, y, x, canvas.height - y);
                    };
                    img.src = xhr.responseURL;
                }
            }
        }, 4000);

        setTimeout(function () {
            xhr.open('GET', 'https://source.unsplash.com/random/?road', true);
            xhr.send(null);
            xhr.onload = function () {
                if (xhr.status !== 200){
                    alert(`Error ${xhr.status}: ${xhr.statusText}`);
                } else {
                    context = canvas.getContext("2d");
                    img = new Image();
                    img.onload = function () {
                        context.drawImage(img, x, y, canvas.width - x, canvas.height - y);
                    };
                    img.src = xhr.responseURL;
                }
            }
        }, 6000);

        setTimeout(function () {
            xhr_ = new XMLHttpRequest();
            xhr_.open('GET', 'https://cors-anywhere.herokuapp.com/http://api.forismatic.com/api/1.0/?method=getQuote&format=text&lang=ru', true);
            xhr_.send(null);
            xhr_.onload = function() {
                if (xhr_.status !== 200) {
                    alert(`Error ${xhr_.status}: ${xhr_.statusText}`);
                } else {
                    context = canvas.getContext("2d");
                    context.filter = "none";
                    context.font = "22px Verdana";
                    context.fillStyle = "#fff";
                    context.textBaseline = "bottom";
                    context.textAlign = "center";

                    words = xhr_.responseText.split(" ");
                    countWords = words.length;
                    maxWidth = canvas.width;
                    marginLeft = canvas.width/2;
                    marginTop = canvas.height/2;
                    lineHeight = 30;
                    line = "";
                    for (var n = 0; n < countWords; n++) {
                        testLine = line + words[n] + " ";
                        testWidth = context.measureText(testLine).width;
                        if (testWidth > maxWidth) {
                            context.fillText(line, marginLeft, marginTop);
                            line = words[n] + " ";
                            marginTop += lineHeight;
                        }
                        else {
                            line = testLine;
                        }
                    }
                    context.fillText(line, marginLeft, marginTop);
                }
            };
        }, 8000);
    </script>
</body>
</html>